# ðŸš€ Buildpack Configuration Guide

## Custom Buildpack Settings Added

Your CannaSpot deployment now includes platform-specific configurations:

### âœ… Files Created:

1. **`render.yaml`** - Render.com Blueprint
2. **`railway.json`** - Railway.app Configuration  
3. **`app.json`** - Heroku App Manifest
4. **`nixpacks.toml`** - Railway Nixpacks Config
5. **`Procfile`** - Universal process file (already exists)
6. **`runtime.txt`** - Python version (already exists)

---

## Platform-Specific Deployment

### ðŸ”µ Render.com

**Auto-Detection**: Render detects `render.yaml` automatically

**What it configures**:
- Python 3.11.9 environment
- Gunicorn with 4 workers
- Health check at `/health`
- Auto-creates PostgreSQL database
- Sets production environment variables

**Deploy**:
1. Connect GitHub repository
2. Render reads `render.yaml`
3. Creates web service + database automatically
4. Sets environment variables from blueprint
5. Deploys!

**Manual Override** (if needed):
- Build Command: `pip install -r requirements.txt`
- Start Command: `gunicorn --bind 0.0.0.0:$PORT wsgi:application --timeout 120 --workers 4`
- Health Check: `/health`

---

### ðŸŸ£ Railway.app

**Auto-Detection**: Railway detects `railway.json` and `nixpacks.toml`

**What it configures**:
- Nixpacks builder with Python 3.11
- Gunicorn startup command
- Health check monitoring
- Restart policy on failure

**Deploy**:
1. Connect GitHub repository
2. Railway reads config files
3. Builds using Nixpacks
4. Deploys automatically

**Manual Override** (if needed):
- Build: Uses `nixpacks.toml` settings
- Start: `gunicorn --bind 0.0.0.0:$PORT wsgi:application --timeout 120 --workers 4`
- Health: `/health`

---

### ðŸŸ£ Heroku

**Auto-Detection**: Heroku detects `app.json`, `Procfile`, `runtime.txt`

**What it configures**:
- Python 3.11.9 buildpack
- PostgreSQL mini addon (free tier)
- Environment variables (auto-generated SECRET_KEY)
- Gunicorn process from Procfile

**Deploy**:

**Option 1: One-Click Deploy Button**
Add to your README:
```markdown
[![Deploy to Heroku](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)
```

**Option 2: CLI Deploy**
```bash
heroku login
heroku create cannaspot-app
git push heroku main
heroku open /install
```

**Manual Override** (if needed):
- Buildpack: `heroku/python` (auto-detected)
- Process: Uses `Procfile`
- Python: Uses `runtime.txt`

---

## Environment Variables

All platforms need these environment variables:

### Required:
```bash
SECRET_KEY=<auto-generated-or-set-manually>
DATABASE_URL=<auto-provided-by-database-addon>
FLASK_ENV=production
```

### Optional (Email):
```bash
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASS=SG.xxxxxxxxxxxxx
SMTP_FROM=noreply@cannaspot.com
SMTP_USE_TLS=true
```

---

## Configuration Details

### render.yaml Highlights:
- Free tier configuration
- PostgreSQL database included
- Auto-generates SECRET_KEY
- Links database to web service
- Oregon region (change as needed)

### railway.json + nixpacks.toml Highlights:
- Nixpacks builder (faster than Docker)
- Python 3.11 with gcc for compilation
- Health check integration
- Auto-restart on failure

### app.json Highlights:
- Heroku-22 stack
- PostgreSQL mini addon
- Auto-generated secrets
- One-click deploy ready
- Optional SMTP configuration

---

## Health Check Endpoint

All configurations use `/health` for monitoring:

**Response**:
```json
{
  "status": "healthy",
  "version": "3.6",
  "database": "healthy",
  "upload_dirs": {
    "videos": true,
    "thumbnails": true,
    "avatars": true
  }
}
```

Platforms check this endpoint to ensure app is running.

---

## Override Instructions by Platform

### Render.com
1. Dashboard â†’ Environment
2. Add/Edit build/start commands
3. Override `render.yaml` settings

### Railway.app
1. Settings â†’ Deploy
2. Custom Build Command: `pip install -r requirements.txt`
3. Custom Start Command: `gunicorn --bind 0.0.0.0:$PORT wsgi:application --timeout 120 --workers 4`

### Heroku
1. Settings â†’ Buildpacks
2. Add: `heroku/python`
3. Config Vars: Set environment variables

---

## Git Deployment

**Everything committed**! Ready to push:

```bash
# View changes
git log --oneline

# Add remote (choose one)
git remote add origin https://github.com/yourusername/cannaspot.git

# Push to deploy
git push origin main
```

---

## Platform Recommendations

### Best for Free Tier:
- **Render.com**: 750 hours/month free, PostgreSQL included
- **Railway.app**: $5 free credit/month, fast deploys
- **Heroku**: Free tier deprecated, eco dyno $5/month

### Best for Performance:
- **Railway.app**: Fast Nixpacks builds, automatic scaling
- **Render.com**: Free SSL, CDN, good uptime

### Best for Beginners:
- **Render.com**: Simple dashboard, good documentation
- **Heroku**: Mature platform, extensive docs

---

## Troubleshooting

### Build fails:
- Check `requirements.txt` has all dependencies
- Verify Python version in `runtime.txt`
- Review build logs for specific errors

### App doesn't start:
- Check `Procfile` command is correct
- Verify `wsgi:application` exists
- Test locally: `gunicorn wsgi:application`

### Health check fails:
- Visit `/health` after deploy
- Check database connection
- Review application logs

### 404 errors:
- Ensure routes are registered
- Run `python check_routes.py` locally
- Check application is running on correct port

---

## Quick Test Locally

Before deploying:

```bash
# Activate environment
python -m venv venv
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# Install dependencies
pip install -r requirements.txt

# Test with Gunicorn
gunicorn wsgi:application

# Visit http://localhost:8000/health
# Should return healthy status
```

---

## Files Summary

**Deployment configs** (all committed):
- âœ… Procfile - Process definition
- âœ… runtime.txt - Python version  
- âœ… render.yaml - Render blueprint
- âœ… railway.json - Railway config
- âœ… nixpacks.toml - Nixpacks builder
- âœ… app.json - Heroku manifest
- âœ… requirements.txt - Dependencies
- âœ… wsgi.py - WSGI entry point

**Your app is now configured for any major deployment platform!** ðŸŽ‰

Choose your platform, connect your repo, and deploy!
